<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<title>VapeStock</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0b0b15;
    color:white;
}

header{
    padding:15px;
    text-align:center;
    font-size:24px;
    background:linear-gradient(45deg,#6a00ff,#c300ff);
}

button{
    background:#a000ff;
    border:none;
    padding:10px;
    color:white;
    border-radius:8px;
    cursor:pointer;
    margin-top:5px;
}

.catalog{
    padding:15px;
}

.card{
    background:#151525;
    padding:15px;
    margin-bottom:15px;
    border-radius:12px;
    box-shadow:0 0 10px #6a00ff88;
}

.card img{
    width:100%;
    border-radius:10px;
}

.admin{
    display:none;
    padding:15px;
    background:#111;
}

input{
    width:100%;
    padding:8px;
    margin:5px 0;
    border-radius:6px;
    border:none;
}
</style>
</head>

<body>

<header>
VapeStock
<br>
<button onclick="toggleAdmin()">Админка</button>
</header>

<div class="catalog" id="catalog"></div>

<div class="admin" id="admin">
<h3>Добавить товар</h3>

<input id="name" placeholder="Название">
<input id="price" placeholder="Цена">
<input id="image" placeholder="URL картинки">

<button onclick="addProduct()">Добавить</button>

<hr>

<h3>Удаление</h3>
<div id="adminList"></div>
</div>

<script type="module">

// Telegram
const tg = window.Telegram.WebApp;
tg.expand();

// Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
  authDomain: "vapestock-3dc76.firebaseapp.com",
  projectId: "vapestock-3dc76",
  storageBucket: "vapestock-3dc76.appspot.com",
  messagingSenderId: "132714146262",
  appId: "1:132714146262:web:70a32b2d068b8f2c155c77"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const catalog = document.getElementById("catalog");
const adminList = document.getElementById("adminList");

async function loadProducts(){
    catalog.innerHTML="";
    adminList.innerHTML="";

    const querySnapshot = await getDocs(collection(db,"products"));

    querySnapshot.forEach((docSnap)=>{
        const p = docSnap.data();
        const id = docSnap.id;

        // витрина
        const div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
            <img src="${p.image}">
            <h3>${p.name}</h3>
            <p>${p.price}</p>
        `;
        catalog.appendChild(div);

        // админ
        const ad=document.createElement("div");
        ad.innerHTML=`
            ${p.name} — ${p.price}
            <button onclick="remove('${id}')">Удалить</button>
        `;
        adminList.appendChild(ad);
    });
}

window.addProduct = async function(){
    const name=document.getElementById("name").value;
    const price=document.getElementById("price").value;
    const image=document.getElementById("image").value;

    if(!name||!price||!image) return alert("Заполни всё");

    await addDoc(collection(db,"products"),{
        name,price,image
    });

    loadProducts();
}

window.remove = async function(id){
    await deleteDoc(doc(db,"products",id));
    loadProducts();
}

window.toggleAdmin = function(){
    const a=document.getElementById("admin");
    a.style.display = a.style.display=="block" ? "none" : "block";
}

loadProducts();

</script>
</body>
</html>
