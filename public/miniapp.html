<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
  margin:0;
  background:#0a0a12;
  font-family:Arial;
  color:white;
}

.title{
  text-align:center;
  color:#c86bff;
  text-shadow:0 0 15px #a100ff;
}

.card{
  background:#141420;
  border-radius:20px;
  padding:15px;
  margin:15px;
  border:1px solid #6a00ff;
  box-shadow:0 0 20px #6a00ff55;
}

.card img{
  width:100%;
  height:150px;
  object-fit:cover;
  border-radius:12px;
}

button{
  margin-top:10px;
  background:#a100ff;
  border:none;
  color:white;
  padding:12px;
  border-radius:10px;
  width:100%;
  font-size:16px;
}

/* —ç–∫—Ä–∞–Ω —Ç–æ–≤–∞—Ä–∞ */
.modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#000;
  display:none;
  overflow:auto;
}

.modal img{
  width:100%;
  height:250px;
  object-fit:cover;
}

.back{
  background:#333;
  margin:10px;
}
</style>

<title>VapeStock</title>
</head>

<body>

<h2 class="title">üí® VapeStock</h2>
<div id="catalog"></div>

<div id="modal" class="modal"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
  authDomain: "vapestock-3dc76.firebaseapp.com",
  projectId: "vapestock-3dc76",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const tg = window.Telegram?.WebApp;
if(tg) tg.expand();

const catalog = document.getElementById("catalog");
const modal = document.getElementById("modal");

async function load(){
  const snap = await getDocs(collection(db,"products"));

  snap.forEach(doc=>{
    const p = doc.data();

    const div = document.createElement("div");
    div.className="card";

    div.innerHTML=`
      <img src="${p.image}">
      <h3>${p.name}</h3>
      <p>${p.price}</p>
    `;

    div.onclick=()=>openProduct(p);
    catalog.appendChild(div);
  });
}

window.openProduct=function(p){
  modal.style.display="block";

  modal.innerHTML=`
    <button class="back" onclick="closeModal()">‚¨Ö –ù–∞–∑–∞–¥</button>
    <img src="${p.image}">
    <div class="card">
      <h2>${p.name}</h2>
      <h3>${p.price}</h3>
      <p>–í –Ω–∞–ª–∏—á–∏–∏: ${p.stock}</p>
      <button onclick='order(${JSON.stringify(p)})'>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  `;
}

window.closeModal=function(){
  modal.style.display="none";
}

window.order=function(p){
  if(tg){
    tg.sendData(JSON.stringify(p));
  }else{
    alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω");
  }
}

load();

</script>

</body>
</html>
