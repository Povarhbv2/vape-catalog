<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<title>VapeStock</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background: radial-gradient(circle at top,#14002a,#050510);
    color:#d8b3ff;
}

/* SIMPLE TOP BAR */
.top{
    height:40px;
}

/* SEARCH */
.search{
    padding:12px;
}
.search input{
    width:100%;
    padding:14px;
    border-radius:14px;
    border:none;
    background:#111122;
    color:#d8b3ff;
}

/* CATEGORIES */
.catbar{
    display:flex;
    gap:8px;
    padding:10px;
    overflow:auto;
}
.cat{
    background:#14002a;
    border:1px solid #a000ff;
    padding:8px 14px;
    border-radius:18px;
    cursor:pointer;
    white-space:nowrap;
}

/* CATALOG */
.catalog{
    padding:15px;
}

/* CARD */
.card{
    background:#111122;
    padding:12px;
    border-radius:16px;
    margin-bottom:18px;
    box-shadow:0 0 20px #6a00ff55;
}
.card img{
    width:100%;
    border-radius:14px;
}

/* PRODUCT */
.productView{
    display:none;
    padding:15px;
}
.bigImg{
    width:100%;
    border-radius:16px;
    box-shadow:0 0 25px #a000ff;
}
.price{
    font-size:24px;
    color:#c77dff;
}

/* BUTTON */
button{
    background:linear-gradient(45deg,#a000ff,#d000ff);
    border:none;
    padding:12px;
    color:white;
    border-radius:10px;
    cursor:pointer;
    margin-top:8px;
}

/* ADMIN */
.admin{
    display:none;
    padding:15px;
    background:#0d0018;
}

input,select{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:8px;
    border:none;
}

.fav{
    font-size:22px;
    cursor:pointer;
}
</style>
</head>

<body>

<!-- —Å–∫—Ä—ã—Ç–∞—è –∑–æ–Ω–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É -->
<div class="top" id="secret"></div>

<div class="search">
<input id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="load()">
</div>

<div class="catbar" id="catbar"></div>

<div class="catalog" id="catalog"></div>
<div class="productView" id="productView"></div>

<div class="admin" id="admin">
<h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>

<input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="price" placeholder="–¶–µ–Ω–∞">
<input id="image" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏">

<select id="category">
<option value="pod">Pod-—Å–∏—Å—Ç–µ–º—ã</option>
<option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç–∏</option>
<option value="disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</option>
<option value="coil">–ò—Å–ø–∞—Ä–∏—Ç–µ–ª–∏</option>
</select>

<button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>
</div>

<script type="module">

const tg=window.Telegram.WebApp;
tg.expand();

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, increment }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const app=initializeApp({
 apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
 authDomain:"vapestock-3dc76.firebaseapp.com",
 projectId:"vapestock-3dc76"
});
const db=getFirestore(app);

let favs=JSON.parse(localStorage.getItem("favs")||"[]");

const catalog=document.getElementById("catalog");
const productView=document.getElementById("productView");

let current="all";

const categories={
 all:"–í—Å–µ",
 pod:"Pod-—Å–∏—Å—Ç–µ–º—ã",
 liquid:"–ñ–∏–¥–∫–æ—Å—Ç–∏",
 disposable:"–û–¥–Ω–æ—Ä–∞–∑–∫–∏",
 coil:"–ò—Å–ø–∞—Ä–∏—Ç–µ–ª–∏"
};

/* CATEGORY BAR */
for(const key in categories){
 const b=document.createElement("div");
 b.className="cat";
 b.innerText=categories[key];
 b.onclick=()=>{current=key;load();}
 catbar.appendChild(b);
}

/* LOAD PRODUCTS */
async function load(){
 catalog.innerHTML="";
 productView.style.display="none";

 const search=searchInput.value.toLowerCase();

 const snap=await getDocs(collection(db,"products"));

 snap.forEach(d=>{
  const p=d.data();
  const id=d.id;

  if(current!="all" && p.category!=current) return;
  if(!p.name.toLowerCase().includes(search)) return;

  const isFav=favs.includes(id);

  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   <img src="${p.image}">
   <h3>${p.name}</h3>
   <p>${p.price}</p>
   <span class="fav">${isFav?"üíú":"ü§ç"}</span>
  `;

  div.onclick=()=>showProduct(p,id);
  div.querySelector(".fav").onclick=(e)=>{
    e.stopPropagation();
    toggleFav(id);
  }

  catalog.appendChild(div);
 });
}

/* FAVORITES */
function toggleFav(id){
 if(favs.includes(id)) favs=favs.filter(x=>x!=id);
 else favs.push(id);
 localStorage.setItem("favs",JSON.stringify(favs));
 load();
}

/* PRODUCT PAGE */
async function showProduct(p,id){
 await updateDoc(doc(db,"products",id),{views:increment(1)});

 catalog.style.display="none";
 productView.style.display="block";

 productView.innerHTML=`
  <button onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
  <img class="bigImg" src="${p.image}">
  <h2>${p.name}</h2>
  <div class="price">${p.price}</div>
  <p>–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: ${p.views||0}</p>
 `;
}

window.back=()=>{
 productView.style.display="none";
 catalog.style.display="block";
}

/* üîê ADMIN ‚Äî 5 –¢–ê–ü–û–í */
let taps=0;
secret.onclick=()=>{
 taps++;
 if(taps>=5){
   const pass=prompt("–ü–∞—Ä–æ–ª—å:");
   if(pass==="lock123612"){
      admin.style.display="block";
   }
   taps=0;
 }
 setTimeout(()=>taps=0,1500);
}

/* ADD PRODUCT */
window.addProduct=async()=>{
 await addDoc(collection(db,"products"),{
  name:name.value,
  price:price.value,
  image:image.value,
  category:category.value,
  views:0
 });
 load();
}

load();

</script>

</body>
</html>
