<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>VapeStock</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
  authDomain: "vapestock-3dc76.firebaseapp.com",
  projectId: "vapestock-3dc76",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db;
window.fs={collection,addDoc,getDocs,deleteDoc,doc,updateDoc};
</script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#0c0018;
  color:white;
}

.header{
  background:linear-gradient(45deg,#6a00ff,#ff00cc);
  padding:20px;
  text-align:center;
  font-size:26px;
  font-weight:bold;
}

#adminBtn{
  position:fixed;
  top:10px;
  right:10px;
  background:#ff00cc;
  border:none;
  color:white;
  padding:10px;
  border-radius:10px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:12px;
}

.card{
  background:#1a0030;
  border-radius:14px;
  padding:10px;
  box-shadow:0 0 10px #a000ff55;
}

.card img{
  width:100%;
  border-radius:10px;
}

.price{
  color:#d580ff;
  font-weight:bold;
}

.adminBtns button{
  margin-top:6px;
  background:#a000ff;
}

input{
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:none;
}

#adminPanel{
  display:none;
  position:fixed;
  inset:0;
  background:#000000ee;
  padding:20px;
  overflow:auto;
}
</style>
</head>

<body>

<div class="header">VapeStock</div>
<button id="adminBtn">⚙️</button>

<div class="grid" id="products"></div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
<h2>Админка</h2>

<input id="name" placeholder="Название">
<input id="price" type="number" placeholder="Цена">
<input id="image" placeholder="Ссылка на фото">

<button onclick="saveProduct()">Сохранить</button>
<button onclick="closeAdmin()">Закрыть</button>
</div>

<script>
const ADMIN_PASS="lock123612";

let editId=null;

// Открытие админки
adminBtn.onclick=()=>{
  let p=prompt("Пароль:");
  if(p===ADMIN_PASS){
    adminPanel.style.display="block";
  }else alert("Неверный пароль");
}

function closeAdmin(){
  adminPanel.style.display="none";
  editId=null;
}

// ДОБАВЛЕНИЕ/РЕДАКТИРОВАНИЕ
async function saveProduct(){
  const name=nameInput.value;
  const price=Number(priceInput.value);
  const image=imageInput.value;

  if(!name||!price||!image){
    alert("Заполни всё");
    return;
  }

  if(editId){
    await fs.updateDoc(fs.doc(db,"products",editId),{
      name,price,image
    });
    editId=null;
  }else{
    await fs.addDoc(fs.collection(db,"products"),{
      name,price,image,views:0
    });
  }

  alert("Сохранено!");
  loadProducts();
}

// ЗАГРУЗКА ТОВАРОВ
async function loadProducts(){
  products.innerHTML="";
  const snap=await fs.getDocs(fs.collection(db,"products"));

  snap.forEach(d=>{
    const p=d.data();
    products.innerHTML+=`
      <div class="card">
        <img src="${p.image}">
        <h3>${p.name}</h3>
        <div class="price">${p.price} ₽</div>

        <div class="adminBtns">
          <button onclick="edit('${d.id}','${p.name}','${p.price}','${p.image}')">Редактировать</button>
          <button onclick="del('${d.id}')">Удалить</button>
        </div>
      </div>
    `;
  });
}

// УДАЛЕНИЕ
async function del(id){
  if(confirm("Удалить товар?")){
    await fs.deleteDoc(fs.doc(db,"products",id));
    loadProducts();
  }
}

// РЕДАКТИРОВАНИЕ
function edit(id,n,p,i){
  adminPanel.style.display="block";
  editId=id;
  nameInput.value=n;
  priceInput.value=p;
  imageInput.value=i;
}

loadProducts();
</script>

</body>
</html>
