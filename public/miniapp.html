<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<title>VapeStock PRO</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#07070f;
    color:white;
}

header{
    padding:15px;
    text-align:center;
    font-size:26px;
    background:linear-gradient(45deg,#6a00ff,#c300ff);
    box-shadow:0 0 20px #a000ff;
}

.category-bar{
    display:flex;
    gap:10px;
    padding:10px;
    overflow:auto;
}

.cat-btn{
    background:#1a1a2e;
    border:1px solid #6a00ff;
    color:white;
    padding:8px 12px;
    border-radius:20px;
    cursor:pointer;
}

.catalog{
    padding:15px;
}

.card{
    background:#111122;
    padding:15px;
    margin-bottom:15px;
    border-radius:12px;
    box-shadow:0 0 15px #6a00ff55;
}

.card img{
    width:100%;
    border-radius:10px;
}

button{
    background:linear-gradient(45deg,#a000ff,#d000ff);
    border:none;
    padding:10px;
    color:white;
    border-radius:8px;
    cursor:pointer;
    margin-top:5px;
}

.admin{
    display:none;
    padding:15px;
    background:#0f0f1a;
}

input,select{
    width:100%;
    padding:10px;
    margin:5px 0;
    border-radius:6px;
    border:none;
}
</style>
</head>

<body>

<header>
VapeStock PRO
<br>
<button onclick="adminLogin()">Админка</button>
</header>

<div class="category-bar" id="cats"></div>

<div class="catalog" id="catalog"></div>

<div class="admin" id="admin">
<h3>Добавить товар</h3>

<input id="name" placeholder="Название">
<input id="price" placeholder="Цена">
<input id="image" placeholder="URL картинки">

<select id="category">
<option value="pod">Pod</option>
<option value="liquid">Жидкости</option>
<option value="disposable">Одноразки</option>
<option value="coil">Испарители</option>
</select>

<button onclick="addProduct()">Добавить</button>

<hr>
<h3>Удаление</h3>
<div id="adminList"></div>
</div>

<script type="module">

const tg = window.Telegram.WebApp;
tg.expand();

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
  authDomain: "vapestock-3dc76.firebaseapp.com",
  projectId: "vapestock-3dc76",
  storageBucket: "vapestock-3dc76.appspot.com",
  messagingSenderId: "132714146262",
  appId: "1:132714146262:web:70a32b2d068b8f2c155c77"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const catalog=document.getElementById("catalog");
const adminList=document.getElementById("adminList");
const catsDiv=document.getElementById("cats");

let currentCat="all";

const categories=["all","pod","liquid","disposable","coil"];

categories.forEach(c=>{
    const b=document.createElement("button");
    b.className="cat-btn";
    b.innerText=c;
    b.onclick=()=>{currentCat=c;loadProducts();}
    catsDiv.appendChild(b);
});

async function loadProducts(){
    catalog.innerHTML="";
    adminList.innerHTML="";

    const snap=await getDocs(collection(db,"products"));

    snap.forEach(d=>{
        const p=d.data();
        const id=d.id;

        if(currentCat!="all" && p.category!=currentCat) return;

        const div=document.createElement("div");
        div.className="card";
        div.innerHTML=`
            <img src="${p.image}">
            <h3>${p.name}</h3>
            <p>${p.price}</p>
            <small>${p.category}</small>
        `;
        catalog.appendChild(div);

        const ad=document.createElement("div");
        ad.innerHTML=`
            ${p.name}
            <button onclick="remove('${id}')">Удалить</button>
        `;
        adminList.appendChild(ad);
    });
}

window.addProduct=async function(){
    const name=nameInput.value;
    const price=priceInput.value;
    const image=imageInput.value;
    const category=categoryInput.value;

    if(!name||!price||!image) return alert("Заполни всё");

    await addDoc(collection(db,"products"),{
        name,price,image,category
    });

    loadProducts();
}

window.remove=async function(id){
    await deleteDoc(doc(db,"products",id));
    loadProducts();
}

// Админ-пароль
window.adminLogin=function(){
    const pass=prompt("Пароль:");
    if(pass==="lock123612"){
        admin.style.display="block";
    }else{
        alert("Неверно");
    }
}

loadProducts();

</script>

</body>
</html>
