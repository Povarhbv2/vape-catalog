<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b0b15;
  color:white;
}

h2{
  text-align:center;
  color:#c86bff;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:10px;
}

.card{
  background:#141426;
  border:1px solid #7b2cff;
  border-radius:12px;
  padding:10px;
}

.card img{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:8px;
}

button{
  background:#a100ff;
  border:none;
  color:white;
  padding:10px;
  width:100%;
  border-radius:10px;
  margin-top:6px;
}

.cartBtn{
  position:fixed;
  bottom:10px;
  left:10px;
  right:10px;
}

.modal{
  position:fixed;
  inset:0;
  background:#000;
  padding:15px;
  display:none;
}

input{
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:none;
}
</style>
</head>

<body>

<h2>ðŸ’¨ VapeStock</h2>

<div id="products" class="grid"></div>

<button class="cartBtn" onclick="openCart()">ðŸ›’ ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°</button>

<div id="modal" class="modal"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
 authDomain:"vapestock-3dc76.firebaseapp.com",
 projectId:"vapestock-3dc76"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let CART=[];
const prodDiv=document.getElementById("products");
const modal=document.getElementById("modal");

async function load(){
 const snap=await getDocs(collection(db,"products"));

 snap.forEach(doc=>{
   const p=doc.data();

   const div=document.createElement("div");
   div.className="card";

   div.innerHTML=`
     <img src="${p.image}">
     <b>${p.name}</b>
     <p>${p.price}</p>
     <button onclick='add(${JSON.stringify(p)})'>Ð’ ÐºÐ¾Ñ€Ð·Ð¸Ð½Ñƒ</button>
   `;

   prodDiv.appendChild(div);
 });
}

window.add=p=>{
 CART.push(p);
 alert("Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾!");
}

window.openCart=()=>{
 modal.style.display="block";

 let html="<h3>ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°</h3>";
 let sum=0;

 CART.forEach(p=>{
   html+=`<p>${p.name} â€” ${p.price}</p>`;
   sum+=Number(p.price.replace(/\D/g,''));
 });

 html+=`
 <p>Ð¡ÑƒÐ¼Ð¼Ð°: ${sum} â‚½</p>

 <input id="fio" placeholder="Ð¤Ð˜Ðž">
 <input id="phone" placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½">

 <button onclick="checkout()">ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·</button>
 <button onclick="modal.style.display='none'">Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ</button>
 `;

 modal.innerHTML=html;
}

window.checkout=async()=>{

 if(CART.length===0){
   alert("ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð° Ð¿ÑƒÑÑ‚Ð°");
   return;
 }

 const fio=document.getElementById("fio").value||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾";
 const phone=document.getElementById("phone").value||"ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½";

 let items="";
 let sum=0;

 CART.forEach(p=>{
   items+=`${p.name} ${p.price}\n`;
   sum+=Number(p.price.replace(/\D/g,''));
 });

 const orderText=`
ÐŸÐ¾ÐºÑƒÐ¿Ð°Ñ‚ÐµÐ»ÑŒ: ${fio}
Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: ${phone}

${items}
Ð¡ÑƒÐ¼Ð¼Ð°: ${sum} â‚½
`;

 await fetch("http://localhost:3001/order",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({
     text:orderText
   })
 });

 alert("âœ… Ð—Ð°ÐºÐ°Ð· Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½!");
 modal.style.display="none";
 CART=[];
}

load();

</script>
</body>
</html>
