<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<title>VapeStock</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#06060f;
    color:white;
}

/* HEADER */
header{
    padding:15px;
    text-align:center;
    font-size:26px;
    background:linear-gradient(45deg,#6a00ff,#c300ff);
    box-shadow:0 0 20px #a000ff;
}

/* SEARCH */
.search{
    padding:10px;
}
.search input{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:none;
    background:#111122;
    color:white;
}

/* CATEGORIES */
.catbar{
    display:flex;
    overflow:auto;
    gap:10px;
    padding:10px;
}
.cat{
    background:#1a1a2e;
    border:1px solid #a000ff;
    padding:8px 14px;
    border-radius:20px;
    cursor:pointer;
    transition:0.3s;
}
.cat:hover{
    box-shadow:0 0 10px #a000ff;
}

/* CATALOG */
.catalog{
    padding:15px;
}

/* CARD */
.card{
    background:#111122;
    padding:10px;
    border-radius:14px;
    margin-bottom:15px;
    box-shadow:0 0 15px #6a00ff55;
    cursor:pointer;
    transform:scale(0.95);
    opacity:0;
    animation:fadeIn 0.4s forwards;
}
@keyframes fadeIn{
    to{transform:scale(1);opacity:1;}
}

.card img{
    width:100%;
    border-radius:12px;
}

/* PRODUCT PAGE */
.productView{
    display:none;
    padding:15px;
    animation:slideUp 0.4s;
}
@keyframes slideUp{
    from{transform:translateY(30px);opacity:0;}
    to{transform:translateY(0);opacity:1;}
}

.bigImg{
    width:100%;
    border-radius:15px;
    box-shadow:0 0 20px #a000ff;
}

.price{
    font-size:24px;
    color:#ff4df0;
}

/* BUTTON */
button{
    background:linear-gradient(45deg,#a000ff,#e100ff);
    border:none;
    padding:12px;
    color:white;
    border-radius:10px;
    margin-top:10px;
    cursor:pointer;
}

/* ADMIN */
.admin{
    display:none;
    padding:15px;
    background:#0e0e18;
}

input,select{
    width:100%;
    padding:10px;
    margin:6px 0;
    border-radius:6px;
    border:none;
}
</style>
</head>

<body>

<header>
VapeStock üíú
<br>
<button onclick="login()">–ê–¥–º–∏–Ω–∫–∞</button>
</header>

<div class="search">
<input id="search" placeholder="–ü–æ–∏—Å–∫..." oninput="load()">
</div>

<div class="catbar" id="catbar"></div>

<div class="catalog" id="catalog"></div>

<div class="productView" id="productView"></div>

<div class="admin" id="admin">
<h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>

<input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="price" placeholder="–¶–µ–Ω–∞">
<input id="image" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏">

<select id="category">
<option value="pod">Pod-—Å–∏—Å—Ç–µ–º—ã</option>
<option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç–∏</option>
<option value="disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</option>
<option value="coil">–ò—Å–ø–∞—Ä–∏—Ç–µ–ª–∏</option>
</select>

<button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å</button>

<hr>
<div id="adminList"></div>
</div>

<script type="module">

const tg=window.Telegram.WebApp;
tg.expand();

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
 authDomain:"vapestock-3dc76.firebaseapp.com",
 projectId:"vapestock-3dc76",
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const catalog=document.getElementById("catalog");
const productView=document.getElementById("productView");
const adminList=document.getElementById("adminList");

let current="all";

const categories={
 all:"–í—Å–µ",
 pod:"Pod-—Å–∏—Å—Ç–µ–º—ã",
 liquid:"–ñ–∏–¥–∫–æ—Å—Ç–∏",
 disposable:"–û–¥–Ω–æ—Ä–∞–∑–∫–∏",
 coil:"–ò—Å–ø–∞—Ä–∏—Ç–µ–ª–∏"
};

for(const key in categories){
 const b=document.createElement("div");
 b.className="cat";
 b.innerText=categories[key];
 b.onclick=()=>{current=key;load();}
 catbar.appendChild(b);
}

async function load(){
 catalog.innerHTML="";
 adminList.innerHTML="";
 productView.style.display="none";
 catalog.style.display="block";

 const search=document.getElementById("search").value.toLowerCase();

 const snap=await getDocs(collection(db,"products"));

 snap.forEach(d=>{
  const p=d.data();
  const id=d.id;

  if(current!="all" && p.category!=current) return;
  if(!p.name.toLowerCase().includes(search)) return;

  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   <img src="${p.image}">
   <h3>${p.name}</h3>
   <p>${p.price}</p>
  `;
  div.onclick=()=>showProduct(p);
  catalog.appendChild(div);

  const ad=document.createElement("div");
  ad.innerHTML=`${p.name} <button onclick="del('${id}')">‚ùå</button>`;
  adminList.appendChild(ad);
 });
}

window.showProduct=function(p){
 catalog.style.display="none";
 productView.style.display="block";
 productView.innerHTML=`
  <button onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
  <img class="bigImg" src="${p.image}">
  <h2>${p.name}</h2>
  <div class="price">${p.price}</div>
  <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${categories[p.category]}</p>
 `;
}

window.back=function(){
 productView.style.display="none";
 catalog.style.display="block";
}

window.addProduct=async function(){
 await addDoc(collection(db,"products"),{
  name:name.value,
  price:price.value,
  image:image.value,
  category:category.value
 });
 load();
}

window.del=async function(id){
 await deleteDoc(doc(db,"products",id));
 load();
}

// üîê –ù–û–í–´–ô –ü–ê–†–û–õ–¨
window.login=function(){
 if(prompt("–ü–∞—Ä–æ–ª—å")==="lock123612"){
  admin.style.display="block";
 }
}

load();

</script>

</body>
</html>
