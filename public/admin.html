<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
 font-family:Arial;
 background:#050010;
 color:white;
 padding:20px;
}

input,select,button{
 width:100%;
 padding:12px;
 margin:8px 0;
 border-radius:10px;
 border:none;
}

button{background:#a000ff;color:white}
.del{background:red}

.card{
 background:#140022;
 padding:10px;
 margin:10px 0;
 border-radius:12px;
}

.progress{
 height:8px;
 background:#333;
 border-radius:10px;
 overflow:hidden;
}
.bar{
 height:100%;
 width:0%;
 background:#a000ff;
}
</style>
</head>

<body>

<div id="loginBox">
<h2>–í—Ö–æ–¥</h2>
<input id="passInput" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div id="panel" style="display:none">

<h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>

<input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<input id="price" placeholder="–¶–µ–Ω–∞">

<input type="file" id="fileInput" accept="image/*" multiple>

<div class="progress"><div class="bar" id="bar"></div></div>

<input id="image" placeholder="–°—Å—ã–ª–∫–∏ –ø–æ—è–≤—è—Ç—Å—è —Ç—É—Ç">

<select id="category">
<option value="pod">Pod</option>
<option value="liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
<option value="disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∞</option>
<option value="coil">–ò—Å–ø–∞—Ä–∏—Ç–µ–ª—å</option>
</select>

<button onclick="add()">–î–æ–±–∞–≤–∏—Ç—å</button>

<h2>–¢–æ–≤–∞—Ä—ã</h2>
<div id="list"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import { getStorage, ref, uploadBytesResumable, getDownloadURL }
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

// Firebase
const app=initializeApp({
 apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
 authDomain:"vapestock-3dc76.firebaseapp.com",
 projectId:"vapestock-3dc76",
 storageBucket:"vapestock-3dc76.appspot.com"
});

const db=getFirestore(app);
const storage=getStorage(app);

// LOGIN
window.login=()=>{
 if(passInput.value==="lock123612"){
  loginBox.style.display="none";
  panel.style.display="block";
  load();
 } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
};

// üì∏ –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û (PRO MAX)
fileInput.onchange=async(e)=>{
 const files=[...e.target.files];
 let urls=[];

 for(const file of files){
   const storageRef=ref(storage,"products/"+Date.now()+file.name);
   const task=uploadBytesResumable(storageRef,file);

   await new Promise(res=>{
     task.on("state_changed",snap=>{
       const prog=(snap.bytesTransferred/snap.totalBytes)*100;
       bar.style.width=prog+"%";
     },
     console.error,
     async ()=>{
       const url=await getDownloadURL(task.snapshot.ref);
       urls.push(url);
       res();
     });
   });
 }

 image.value=urls.join(",");
 alert("–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
};

// ‚ûï –î–û–ë–ê–í–õ–ï–ù–ò–ï
window.add=async()=>{
 if(!name.value||!price.value||!image.value){
   alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å—ë");
   return;
 }

 await addDoc(collection(db,"products"),{
  name:name.value,
  price:price.value,
  images:image.value.split(","),
  category:category.value
 });

 alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
 name.value="";price.value="";image.value="";
 load();
};

// üì¶ –°–ü–ò–°–û–ö
async function load(){
 list.innerHTML="";
 const snap=await getDocs(collection(db,"products"));

 snap.forEach(d=>{
  const p=d.data();

  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   ${p.name} ‚Äî ${p.price}
   <button class="del">–£–¥–∞–ª–∏—Ç—å</button>
   <button class="edit">–ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É</button>
  `;

  div.querySelector(".del").onclick=async()=>{
    await deleteDoc(doc(db,"products",d.id));
    load();
  };

  div.querySelector(".edit").onclick=async()=>{
    const np=prompt("–ù–æ–≤–∞—è —Ü–µ–Ω–∞:",p.price);
    if(np){
      await updateDoc(doc(db,"products",d.id),{price:np});
      load();
    }
  };

  list.appendChild(div);
 });
}

</script>
</body>
</html>
