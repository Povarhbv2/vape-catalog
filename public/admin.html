<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VapeStock Admin</title>

<style>
body{
  font-family:sans-serif;
  background:#0a0014;
  color:white;
  padding:20px;
}

input,select,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:none;
  font-size:16px;
}

button{
  background:linear-gradient(45deg,#8f00ff,#d000ff);
  color:white;
}

.card{
  background:#140028;
  padding:10px;
  border-radius:12px;
  margin-top:10px;
}

img{
  max-width:100%;
  border-radius:12px;
}
</style>
</head>

<body>

<h2>Админ вход</h2>
<input id="pass" placeholder="Пароль">
<button onclick="login()">Войти</button>

<div id="panel" style="display:none">

<h2>Добавить товар</h2>

<input id="name" placeholder="Название">
<input id="price" placeholder="Цена">

<select id="cat">
<option>Pod</option>
<option>Одноразка</option>
<option>Жидкости</option>
</select>

<input type="file" id="file">
<button onclick="uploadPhoto()">Загрузить фото</button>

<img id="preview">

<button onclick="saveProduct()">Сохранить</button>

<h2>Товары</h2>
<div id="list"></div>

</div>

<script type="module">

/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore,collection,addDoc,getDocs,deleteDoc,doc,updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
  apiKey:"YOUR_KEY",
  authDomain:"YOUR_DOMAIN",
  projectId:"vapestock-3dc76"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* ---------- CLOUDINARY ---------- */
const CLOUD="dhmrlczr8";
const PRESET="vapestock"; // имя unsigned preset

let imageURL="";
let editId=null;

/* ---------- LOGIN ---------- */
window.login=()=>{
 if(document.getElementById("pass").value==="lock123612"){
   panel.style.display="block";
   load();
 }
}

/* ---------- UPLOAD ---------- */
window.uploadPhoto=async()=>{
 const file=fileInput.files[0];
 if(!file){alert("Выбери фото");return;}

 const fd=new FormData();
 fd.append("file",file);
 fd.append("upload_preset",PRESET);

 const r=await fetch(`https://api.cloudinary.com/v1_1/${CLOUD}/image/upload`,{
   method:"POST",
   body:fd
 });

 const d=await r.json();

 imageURL=d.secure_url;
 preview.src=imageURL;
 alert("Фото загружено!");
}

/* ---------- SAVE ---------- */
window.saveProduct=async()=>{
 const nameVal=name.value.trim();
 const priceVal=price.value.trim();
 const catVal=cat.value;

 if(!nameVal||!priceVal||!imageURL){
   alert("Заполни всё + фото");
   return;
 }

 const data={
   name:nameVal,
   price:priceVal,
   category:catVal,
   image:imageURL,
   views:0
 };

 if(editId){
   await updateDoc(doc(db,"products",editId),data);
   editId=null;
 }else{
   await addDoc(collection(db,"products"),data);
 }

 name.value="";
 price.value="";
 preview.src="";
 imageURL="";

 load();
 alert("Сохранено!");
}

/* ---------- LOAD ---------- */
async function load(){
 list.innerHTML="";
 const snap=await getDocs(collection(db,"products"));

 snap.forEach(d=>{
   const p=d.data();

   list.innerHTML+=`
   <div class="card">
     <img src="${p.image}">
     <b>${p.name}</b><br>
     ${p.price} ₽<br>
     ${p.category}<br>

     <button onclick="edit('${d.id}','${p.name}','${p.price}','${p.category}','${p.image}')">Редактировать</button>
     <button onclick="del('${d.id}')">Удалить</button>
   </div>`;
 });
}

/* ---------- EDIT ---------- */
window.edit=(id,n,p,c,i)=>{
 editId=id;
 name.value=n;
 price.value=p;
 cat.value=c;
 preview.src=i;
 imageURL=i;
}

/* ---------- DELETE ---------- */
window.del=async(id)=>{
 await deleteDoc(doc(db,"products",id));
 load();
}

</script>
</body>
</html>
