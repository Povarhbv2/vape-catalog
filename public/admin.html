<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADMIN FIX</title>

<style>
body{background:#0a0014;color:white;font-family:sans-serif;padding:20px}
input,select,button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none}
button{background:linear-gradient(45deg,#8f00ff,#d000ff);color:white}
.card{background:#140028;padding:10px;border-radius:12px;margin-top:10px}
img{max-width:100%;border-radius:12px}
</style>
</head>

<body>

<h2>Вход</h2>
<input id="pass">
<button onclick="login()">Войти</button>

<div id="panel" style="display:none">

<h2>Добавить товар</h2>

<input id="name" placeholder="Название">
<input id="price" placeholder="Цена">

<select id="cat">
<option>Pod</option>
<option>Одноразка</option>
<option>Жидкость</option>
</select>

<input type="file" id="file">
<button onclick="uploadPhoto()">Загрузить фото</button>

<img id="preview">

<button onclick="saveProduct()">Сохранить</button>

<h2>Товары</h2>
<div id="list"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore,collection,addDoc,getDocs,deleteDoc,doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
 authDomain:"vapestock-3dc76.firebaseapp.com",
 projectId:"vapestock-3dc76"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const CLOUD="dhmrlczr8";
const PRESET="vapestock";

let imageURL="";

/* LOGIN */
window.login=()=>{
 if(pass.value==="lock123612"){
  panel.style.display="block";
  load();
 }
};

/* UPLOAD */
window.uploadPhoto=async()=>{
 const f=file.files[0];
 if(!f){alert("Выбери фото");return;}

 const fd=new FormData();
 fd.append("file",f);
 fd.append("upload_preset",PRESET);

 const r=await fetch(
  `https://api.cloudinary.com/v1_1/${CLOUD}/image/upload`,
  {method:"POST",body:fd}
 );

 const d=await r.json();

 if(!d.secure_url){
  alert("Ошибка загрузки!");
  return;
 }

 imageURL=String(d.secure_url);
 preview.src=imageURL;
};

/* SAVE */
window.saveProduct=async()=>{

 const nameVal=name.value.trim();
 const priceVal=price.value.trim();
 const catVal=cat.value;

 if(!nameVal || !priceVal || !imageURL){
  alert("Заполни всё!");
  return;
 }

 const data={
  name:String(nameVal),
  price:String(priceVal),
  category:String(catVal),
  image:String(imageURL),
  views:0
 };

 console.log("SEND:",data);

 await addDoc(collection(db,"products"),data);

 alert("Сохранено!");

 name.value="";
 price.value="";
 preview.src="";
 imageURL="";

 load();
};

/* LOAD */
async function load(){
 list.innerHTML="";
 const snap=await getDocs(collection(db,"products"));

 snap.forEach(d=>{
  const p=d.data();
  list.innerHTML+=`
  <div class="card">
   <img src="${p.image}">
   <b>${p.name}</b><br>
   ${p.price}₽<br>
   ${p.category}<br>
   <button onclick="del('${d.id}')">Удалить</button>
  </div>`;
 });
}

/* DELETE */
window.del=async(id)=>{
 await deleteDoc(doc(db,"products",id));
 load();
};

</script>
</body>
</html>
