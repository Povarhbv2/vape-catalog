<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Admin</title>

<style>
body{
  background:#0b0618;
  color:white;
  font-family:sans-serif;
  padding:15px;
}
input,select,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:none;
}
button{
  background:linear-gradient(45deg,#7b00ff,#ff00cc);
  color:white;
  font-size:16px;
}
.card{
  background:#111;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
}
</style>
</head>

<body>

<h2>Админ вход</h2>
<input id="pass" placeholder="Пароль"/>
<button onclick="login()">Войти</button>

<div id="panel" style="display:none">

<h3>Добавить товар</h3>

<input id="name" placeholder="Название"/>
<input id="price" placeholder="Цена"/>
<input id="img" placeholder="URL фото"/>
<select id="cat">
<option value="pod">Pod</option>
<option value="liquid">Жидкость</option>
<option value="disposable">Одноразка</option>
</select>

<button onclick="save()">Сохранить</button>

<hr>
<h3>Товары</h3>
<div id="list"></div>

</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyDJxLWeTxVeH2r64rv9rCLUW4RtM1A6zXI",
  authDomain:"vapestock-3dc76.firebaseapp.com",
  projectId:"vapestock-3dc76"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

window.login=()=>{
  if(pass.value==="lock123612"){
    panel.style.display="block";
    load();
  } else alert("Неверный пароль");
};

window.save=async()=>{
  try{
    if(!name.value.trim() || !price.value.trim() || !img.value.trim()){
      alert("Заполни ВСЕ поля!");
      return;
    }

    await addDoc(collection(db,"products"),{
      name:name.value,
      price:price.value,
      image:img.value,
      category:cat.value
    });

    alert("Товар добавлен ✅");

    name.value="";
    price.value="";
    img.value="";
    load();

  }catch(e){
    alert("Ошибка: "+e.message);
    console.log(e);
  }
};

window.load=async()=>{
  list.innerHTML="";
  const snap=await getDocs(collection(db,"products"));

  snap.forEach(d=>{
    const p=d.data();
    list.innerHTML+=`
      <div class="card">
        ${p.name} — ${p.price}₽
        <button onclick="del('${d.id}')">Удалить</button>
      </div>`;
  });
};

window.del=async(id)=>{
  await deleteDoc(doc(db,"products",id));
  load();
};
</script>

</body>
</html>
